---
import NavbarLink from './NavbarLink.vue'
import { nav } from '@data/links.json'

const currentPathname = Astro.url.pathname;
---
<nav class="navbar is-primary" role="navigation" aria-label="main navigation">
	<div class="navbar-brand">
		<a class="navbar-item" href="/">
			<img class="image is-48x48" src="/images/logo.svg" alt="UAIS Logo" width="56">
			<span class="is-size-3 px-1 has-text-white has-text-weight-bold">UAIS</span>
		</a>
		<a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarMenu">
			<span aria-hidden="true"></span>
			<span aria-hidden="true"></span>
			<span aria-hidden="true"></span>
		</a>
	</div>
	<div id="navbarMenu" class="navbar-menu">
		<div class="navbar-end">
			{nav.map(item => {
				if (item.submenu) {
					const isDropdownActive = item.submenu.some(sublink => sublink.link === currentPathname);
					return (
						<div class:list={["navbar-item", "has-dropdown", "is-hoverable", { "is-active": isDropdownActive }]}>
							<a class="navbar-link">
								{ item.icon && <span class="icon has-text-info"><i class={item.icon}></i></span> }
								<span>{item.text}</span>
							</a>
							<div class="navbar-dropdown is-boxed">
								{item.submenu.map(sublink => (
									<NavbarLink client:visible link={sublink} currentPathname={currentPathname} />
								))}
							</div>
						</div>
					);
				} else {
					return <NavbarLink client:visible link={item} currentPathname={currentPathname} />;
				}
			})}
		</div>
	</div>
</nav>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		const burger = document.querySelector('.navbar-burger');
		const menu = document.querySelector('.navbar-menu');
		if (burger && menu) {
			burger.addEventListener('click', () => {
				burger.classList.toggle('is-active');
				menu.classList.toggle('is-active');
			});
		}
	});
</script>